---
title: "[3. 콜백을 사용한 비동기 제어 흐름 패턴] 3.2 일반 JavaScript의 사용"
date: 2019-05-27 10:00:00
categories: nodejs designpattern
comments: true


---

## 3.2 일반 JavaScript의 사용

비동기 코드를 작성할 때 주의해야 할 여러 사항이 있다. 실제로 일련의 비동기 작업들의 흐름을 제어하려면 특정 패턴과 기법을 사용해야만 하는 상황이 있다. 특히 외부 라이브러리를 사용하지 않고 일반 JavaScript만 사용하는 경우에는 더욱 그렇다. 예를 들어, 순서에 따라 비동기 작업을 적용하는 컬렉션을 반복하는 것은 배열에 대해 forEach()를 호출하는 것처럼 쉽지는 않으며 실제로 재귀와 유사한 기술을 필요로 한다.

### 3.2.1 콜백 규칙

비동기 코드를 작성할 때 명심해야 할 첫 번째 규칙은 콜백을 정의할 때 함부로 클로저를 사용하지 않는 것이다. 모듈화 및 재사용과 같은 문제에 대한 추가적인 사항을 고려할 필요가 없어 매력적이겠지만 이는 장점 보다 단점이 더 많을 수 있는 방식임을 알고 있다. 대부분의 경우 콜백 헬 문제를 해결하기 위한 어떤 라이브러리나 멋진 기술 혹은 패러다임의 변화가 필요한 것은 아니며, 간단한 일반적이 상식이면 충분하다.

아래는 중첩 수준을 낮게 유지하고 일반적으로 코드 체계를 개선하는데 도움이 되는 몇 가지 기본 원칙이다.

- 가능한 빨리 종료한다. 문맥에 따라 return, continue 또는 break를 사용하면 if … else 문(및 중첩)을 모두 작성하는 대신 현재 문을 즉시 종료할 수 있다. 이렇게 하면 코드를 얕게 유지하는데 도움이 된다.
- 콜백을 위해 명명된 함수를 생성하여 클로저 바깥에 배치하며 중간 결과를 인자로 전달한다. 함수의 이름을 지정하면 스택 추적에서 더 잘 보이게 된다.
- 코드를 모듈화해야 한다. 가능하면 코드를 작고 재사용 가능한 함수들로 분할하라.

